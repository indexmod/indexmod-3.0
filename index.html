<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Генератор статей</title>
<style>
  body { font-family: Arial, sans-serif; padding: 20px; }
  ul { list-style: none; padding: 0; }
  li { margin: 5px 0; cursor: pointer; color: blue; }
  li:hover { text-decoration: underline; }
  #modal {
    display: none;
    position: fixed; top:0; left:0; width:100%; height:100%;
    background: rgba(0,0,0,0.6); justify-content:center; align-items:center;
  }
  #modalContent {
    background: white; padding: 20px; max-width: 800px; max-height: 80%;
    overflow: auto; border-radius: 8px; position: relative;
  }
  #close { position: absolute; top:10px; right:10px; cursor:pointer; }
  button { margin-top: 10px; }
</style>
</head>
<body>

<h1>Список топиков</h1>
<ul id="topics"></ul>

<div id="modal">
  <div id="modalContent">
    <span id="close">✖</span>
    <div id="article"></div>
    <button id="downloadMd">Скачать Markdown</button>
    <button id="downloadPdf">Скачать PDF</button>
  </div>
</div>

<script>
const workerUrl = "https://steep-block-7d70.indexmod-ce3.workers.dev/";

// Загружаем топики из файла
fetch('topics.txt')
  .then(res => res.text())
  .then(text => {
    const topics = text.split('\n').map(t => t.trim()).filter(Boolean);
    topics.sort((a,b) => a.localeCompare(b));
    const ul = document.getElementById('topics');
    topics.forEach(topic => {
      const li = document.createElement('li');
      li.textContent = topic;
      li.onclick = () => generateArticle(topic);
      ul.appendChild(li);
    });
  });

// Генерация статьи через Worker
function generateArticle(topic) {
  fetch(workerUrl, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ topic })
  })
  .then(res => res.json())
  .then(data => showModal(topic, data.article))
  .catch(err => alert('Ошибка генерации: ' + err));
}

// Модальное окно
const modal = document.getElementById('modal');
const articleDiv = document.getElementById('article');
document.getElementById('close').onclick = () => modal.style.display = 'none';

function showModal(topic, content) {
  articleDiv.textContent = content;
  modal.style.display = 'flex';

  document.getElementById('downloadMd').onclick = () => {
    downloadFile(topic + ".md", content);
  };

  document.getElementById('downloadPdf').onclick = () => {
    generatePdf(topic, content);
  };
}

// Скачивание Markdown
function downloadFile(filename, text) {
  const blob = new Blob([text], { type: 'text/markdown' });
  const link = document.createElement('a');
  link.href = URL.createObjectURL(blob);
  link.download = filename;
  link.click();
}

// Генерация PDF (через jsPDF)
function generatePdf(title, text) {
  import('https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js').then(jsPDF => {
    const doc = new jsPDF.jsPDF();
    const lines = doc.splitTextToSize(text, 180);
    doc.text(title, 10, 10);
    doc.text(lines, 10, 20);
    doc.save(title + '.pdf');
  });
}
</script>

</body>
</html>
